{% extends 'base.html' %}

{% block style %}
.btn-large:hover {
    background-color: inherit !important;
}
.input-field input:focus + label {
    color: #f44336 !important;
}
.input-field input:focus {
    border-bottom: 1px solid #f44336 !important;
    box-shadow: 0 1px 0 0 #f44336 !important
}
textarea.materialize-textarea:focus {
    border-bottom: 1px solid #f44336 !important;
    box-shadow: 0 1px 0 0 #f44336 !important;
}

.input-field textarea:focus + label {
    color: #f44336 !important;
}
#timeline > div > div:nth-child(1) > div > svg > g:nth-child(3) > text {
    fill: white !important;
}

#timeline > div > div:nth-child(1) > div > svg > g:nth-child(2) > rect {
    display: none !important;
}

.tooltip {
    background-color: black;
    color: white;
    padding: 1em;
    display: inline-block;
    white-space: nowrap;
}

{% endblock %}

{% block content %}
<div class="row"><h2 class="center-align red-text">stats for <span class="white-text">{{group.name}}</span></h2></div>
<div class="row"><div class="col s12 center-align">
        <a class="{%if sel == 'all'%}white-text{%else%}red-text{%endif%}" href="/group/{{group.id}}/all">all</a>
        <a class="{%if sel == 'day'%}white-text{%else%}red-text{%endif%}" href="/group/{{group.id}}/day">day</a>
        <a class="{%if sel == 'week'%}white-text{%else%}red-text{%endif%}" href="/group/{{group.id}}/week">week</a>
        <a class="{%if sel == 'month'%}white-text{%else%}red-text{%endif%}" href="/group/{{group.id}}/month">month</a>
    </div>
</div>
<div class="row">
    <div class="col s12">
        <div class="card grey darken-4">
            <div class="card-content">
                <span class="card-title">activity log</span>
                <div class="row" style="margin-bottom: -30px !important">
                    <div class="col s12" id="timeline" style="height: {{ 50 * (group.members | length) + 50 }}px"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block header_entry %}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
google.charts.load('current', {'packages':['timeline']});
google.charts.setOnLoadCallback(drawChart);
function drawChart() {
    var container = document.getElementById('timeline');
    var chart = new google.visualization.Timeline(container);
    var dataTable = new google.visualization.DataTable();

    dataTable.addColumn({ type: 'string', id: 'person' });
    dataTable.addColumn({ type: 'string', id: 'dummy bar label' });
    dataTable.addColumn({ type: 'string', id: 'style', role: 'style' });
    dataTable.addColumn({ type: 'string', role: 'tooltip', 'p': {'html': true}});
    dataTable.addColumn({ type: 'date', id: 'start' });
    dataTable.addColumn({ type: 'date', id: 'end' });
    dataTable.addRows([
        {% for event in events %}
        [ {{ event | safe }} ],
        {% endfor %}
        ]);

    var dayStart = new Date();
    dayStart.setHours(0, 0, 0, 0);
    var dayEnd = new Date(dayStart)
    dayEnd.setDate(dayEnd.getDate() + 1)
    {% if sel == 'week' %}
    dayStart.setDate(dayStart.getDate() - 6)
    {% elif sel == 'month' %}
    dayStart.setDate(dayStart.getDate() - 29)
    {% endif %}

    var options = {
        backgroundColor: '#212121',
        colors: ['#f44336'],
        tooltip: {
            isHtml: true
        },
        hAxis: {
            minValue: dayStart,
            maxValue: dayEnd,
            format: 'M/d\nHH:mm'
        },
        timeline: {
            rowLabelStyle: {
                color: 'white'
            }
        }
    };

    chart.draw(dataTable, options);
}
</script>
{% endblock %}
